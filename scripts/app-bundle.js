define("app",["exports","./environment","aurelia-router","aurelia-framework","aurelia-fetch-client"],function(e,t,n,r,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0;var s,l,d=i(t),c=(e.App=(s=(0,r.inject)(o.HttpClient,n.Router),s(l=function(){function e(t,n){a(this,e),this.httpClient=t,this.message="Hello World!",this.httpClient.configure(function(e){e.withBaseUrl(d.default.apiEndpoint).withInterceptor({request:function(e){return e.headers.set("AccessKey",localStorage.getItem("accessKey")),e},response:function(e){if(e.status>=400&&e.status<=599)throw 401==e.status&&(localStorage.removeItem("accessKey"),n.navigate("/sign-in")),e;return e}})})}return e.prototype.configureRouter=function(e,t){e.title="CPA Admin",e.addPipelineStep("authorize",c),e.options.pushState=!1,e.map([{route:"",redirect:"dashboard"},{route:"dashboard",moduleId:"./dashboard/dashboard",title:"Dashboard",nav:!0,settings:{roles:["authenticated"]}},{route:"sign-in",moduleId:"./sign-in/sign-in",name:"sign-in",title:"Sign in",settings:{roles:[]}}]),this.router=t},e}())||l),function(){function e(){a(this,e)}return e.prototype.run=function(e,t){if(e.getAllInstructions().some(function(e){return e.config.settings.roles.indexOf("authenticated")!==-1})){var r=null!=localStorage.getItem("accessKey");if(!r)return t.cancel(new n.Redirect("sign-in"))}return t()},e}())}),define("environment",["exports"],function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={debug:!1,testing:!1}}),define("main",["exports","./environment"],function(e,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e){e.use.standardConfiguration().globalResources("resources/attributes/place-autocomplete").feature("resources"),o.default.debug&&e.use.developmentLogging(),o.default.testing&&e.use.plugin("aurelia-testing"),o.default.apiEndpoint="http://api.cpafrance.fr/",e.start().then(function(){return e.setRoot()})}Object.defineProperty(e,"__esModule",{value:!0}),e.configure=r;var o=n(t);Promise.config({longStackTraces:o.default.debug,warnings:{wForgottenReturn:!1}})}),define("dashboard/dashboard",["exports","aurelia-framework","aurelia-router","aurelia-fetch-client"],function(e,t,n,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Dashboard=void 0;var i,a;e.Dashboard=(i=(0,t.inject)(r.HttpClient,n.Router),i(a=function(){function e(t,n){o(this,e),this.httpClient=t}return e.prototype.configureRouter=function(e,t){e.map([{route:"",moduleId:"./index/index",name:"d-index",title:"Index",nav:!0},{route:"organisations",moduleId:"./orgs-list/orgs-list",name:"d-orgs-list",title:"Organisations",nav:!0},{route:"organisations/:id",moduleId:"./orgs-show/orgs-show",name:"d-orgs-show"},{route:"organisations/create",moduleId:"./orgs-create/orgs-create",name:"d-orgs-create"}]),this.router=t},e.prototype.activate=function(){var e=this;return this.httpClient.fetch("authentication",{method:"POST",body:(0,r.json)({accessKey:localStorage.getItem("accessKey")})}).then(function(e){return e.json()}).then(function(t){e.account=t})},e.prototype.signOut=function(){localStorage.removeItem("accessKey"),this.router.navigateToRoute("sign-in")},e}())||a)}),define("resources/index",["exports"],function(e){"use strict";function t(e){}Object.defineProperty(e,"__esModule",{value:!0}),e.configure=t}),define("sign-in/sign-in",["exports","aurelia-framework","aurelia-fetch-client","aurelia-router"],function(e,t,n,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.SignIn=void 0;var i,a;e.SignIn=(i=(0,t.inject)(n.HttpClient,r.Router),i(a=function(){function e(t,n){o(this,e),this.httpClient=t,this.router=n,this.realm="A",this.hasError=!1,this.isFetching=!1}return e.prototype.activate=function(e){e.accessKey&&(localStorage.setItem("accessKey",e.accessKey),this.router.navigate("/dashboard"))},e.prototype.signIn=function(){var e=this;this.hasError=!1,this.isFetching=!0,this.httpClient.fetch("authentication",{method:"POST",body:(0,n.json)({mailAddress:this.email,password:this.password,realm:this.realm})}).then(function(e){return e.json()}).then(function(t){e.isFetching=!1,localStorage.setItem("accessKey",t.accessKey),e.router.navigate("/dashboard")}).catch(function(t){console.log(t),e.hasError=!0,e.isFetching=!1})},e}())||a)}),define("dashboard/index/index",["exports"],function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});e.Index=function e(){t(this,e)}}),define("dashboard/orgs-create/orgs-create",["exports","aurelia-framework","aurelia-fetch-client","aurelia-router"],function(e,t,n,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.OrgsCreate=void 0;var i,a;e.OrgsCreate=(i=(0,t.inject)(n.HttpClient,r.Router),i(a=function(){function e(t,n){o(this,e),this.httpClient=t,this.router=n,this.input={category:"université",address:{},contact:{}},this.errors={}}return e.prototype.create=function(){var e=this;console.log(JSON.stringify(this.input,null,2)),this.errors={},this.httpClient.fetch("organisations",{method:"POST",body:(0,n.json)(this.input)}).then(function(e){return e.json()}).then(function(t){console.log("data",t),e.router.navigateToRoute("d-orgs-show",{id:t.id})}).catch(function(t){return console.log(t),409==t.status?(e.errors.mailAddress="Conflict",void console.log(e.errors)):void t.json().then(function(t){return e.errors=t})})},e}())||a)}),define("dashboard/orgs-list/orgs-list",["exports","aurelia-framework","aurelia-fetch-client"],function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.OrgsList=void 0;var o,i;e.OrgsList=(o=(0,t.inject)(n.HttpClient),o(i=function(){function e(t){r(this,e),this.httpClient=t}return e.prototype.activate=function(){var e=this;return this.httpClient.fetch("organisations").then(function(e){return e.json()}).then(function(t){return e.organisations=t})},e}())||i)}),define("dashboard/orgs-show/orgs-show",["exports","aurelia-framework","aurelia-fetch-client","aurelia-router"],function(e,t,n,r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.OrgsShow=void 0;var i,a,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e.OrgsShow=(i=(0,t.inject)(n.HttpClient,r.Router),i(a=function(){function e(t,n){o(this,e),this.httpClient=t,this.router=n,this.isEditing=!1,this.input=null,this.errors={}}return e.prototype.activate=function(e){var t=this;return console.log(e),this.httpClient.fetch("organisations/"+e.id).then(function(e){return e.json()}).then(function(e){return t.org=e})},e.prototype.startEdit=function(){this.isEditing=!0,this.input=JSON.parse(JSON.stringify(this.org))},e.prototype.cancelEdit=function(){this.isEditing=!1,this.input=null},e.prototype.update=function(){var e=this;this.httpClient.fetch("organisations/"+this.input.id,{method:"PUT",body:(0,n.json)(this.input)}).then(function(t){e.org=e.input,e.cancelEdit()}).catch(function(t){return t.json().then(function(t){return e.errors=t})})},e.prototype.delete=function(){var e=this;confirm("Are you sure you want to delete this organisation?")&&this.httpClient.fetch("organisations/"+this.org.id,{method:"DELETE"}).then(function(t){e.router.navigateToRoute("d-orgs-list")}).catch(function(e){return console.log(e)})},s(e,[{key:"orgAsJSON",get:function(){return JSON.stringify(this.org,null,2)}}]),e}())||a)}),define("resources/attributes/place-autocomplete",["exports","aurelia-framework"],function(e,t){"use strict";function n(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}Object.defineProperty(e,"__esModule",{value:!0}),e.PlaceAutocompleteCustomAttribute=void 0;var i,a,s,l,d,c,u;e.PlaceAutocompleteCustomAttribute=(i=(0,t.inject)(Element),i((s=function(){function e(t){r(this,e),n(this,"target",l,this),n(this,"userSelectionBinding",d,this),n(this,"targetProperty",c,this),n(this,"restrictions",u,this),this.element=t}return e.prototype.created=function(){this.restrictions?"regions"==this.restrictions&&(this.restrictions=["(regions)"]):this.restrictions=["geocode"]},e.prototype.attached=function(){var e=this;google.maps.event.addDomListener(this.element,"keydown",function(e){13==e.keyCode&&(console.log("enter"),e.preventDefault())});var t={types:this.restrictions,componentRestrictions:{country:"fr"}};this.autocomplete=new google.maps.places.Autocomplete(this.element,t),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lng:t.coords.longitude},r=new google.maps.Circle({center:n,radius:t.coords.accuracy});e.autocomplete.setBounds(r.getBounds())}),this.targetProperty=[this.targetProperty||"address"],this.target[this.targetProperty]&&this.target[this.targetProperty].formattedAddress&&(this.element.value=this.target[this.targetProperty].formattedAddress),this.autocomplete.addListener("place_changed",function(){var t=e.autocomplete.getPlace(),n={formatted_address:t.formatted_address,placeId:t.place_id};t.address_components.forEach(function(e){var t=e.types[0];n[t]=e.short_name}),n.lat=t.geometry.location.lat(),n.lng=t.geometry.location.lng();var r={};r.formattedAddress=n.formatted_address,(n.street_number||n.route)&&(r.street1=n.street_number?n.street_number+" "+n.route:n.route),n.postal_code&&(r.postalCode=n.postal_code),r.locality=0==n.locality.indexOf("Paris-")?"Paris":n.locality,r.country="FR"==n.country?"France":n.country,r.lat=n.lat,r.lng=n.lng,r.googleMapId=n.placeId,e.target[e.targetProperty]=r,e.userSelectionBinding&&(e.element.value=r[e.userSelectionBinding])})},e}(),l=o(s.prototype,"target",[t.bindable],{enumerable:!0,initializer:null}),d=o(s.prototype,"userSelectionBinding",[t.bindable],{enumerable:!0,initializer:null}),c=o(s.prototype,"targetProperty",[t.bindable],{enumerable:!0,initializer:null}),u=o(s.prototype,"restrictions",[t.bindable],{enumerable:!0,initializer:null}),a=s))||a)}),define("text!app.html",["module"],function(e){e.exports='<template>\n    <!--<div if.bind="router.isNavigating">Loading...</div>-->\n   <router-view></router-view>\n</template>\n'}),define("text!sign-in/sign-in.html",["module"],function(e){e.exports='<template>\n  <h1>Sign in</h1>\n  <form submit.delegate="signIn()">\n    <div class="alert alert-danger" role="alert" if.bind="hasError">\n      Bad email or password. Try again.\n    </div>\n    <div class="form-group">\n      <label for="exampleInputEmail1">Email address</label>\n      <input type="email" class="form-control" placeholder="Email" value.bind="email">\n    </div>\n    <div class="form-group">\n      <label for="exampleInputPassword1">Password</label>\n      <input type="password" class="form-control" placeholder="Password" value.bind="password">\n    </div>\n    <button type="submit" class="btn btn-default" disabled.bind="isFetching">\n      ${isFetching ? \'Signing in...\' : \'Sign in\'}\n    </button>\n  </form>\n</template>\n'}),define("text!dashboard/dashboard.html",["module"],function(e){e.exports='<template>\n  <nav class="navbar navbar-default">\n    <div class="container-fluid">\n      <div class="navbar-header">\n        <a class="navbar-brand" href="#">CPA Backend</a>\n      </div>\n\n      <ul class="nav navbar-nav">\n        <li repeat.for="row of router.navigation" class="${row.isActive ? \'active\' : \'\'}">\n          <a href.bind="row.href">${row.title}</a>\n        </li>\n      </ul>\n      <ul class="nav navbar-nav navbar-right">\n        <li class="dropdown">\n          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">\n            Signed in as <b>${account.name}</b> <span class="caret"></span>\n          </a>\n          <ul class="dropdown-menu">\n            <li><a href="#" click.delegate="signOut()">Sign out</a></li>\n          </ul>\n        </li>\n      </ul>\n    </div>\n  </nav>\n\n  <router-view></router-view>\n</template>\n'}),define("text!dashboard/orgs-create/orgs-create.html",["module"],function(e){e.exports='<template>\n  <ol class="breadcrumb">\n    <li><a route-href="route: d-orgs-list">Organisations</a></li>\n    <li class="active">Create</li>\n  </ol>\n\n  <div class="row toolbar">\n    <div class="col-md-8 toolbar__header">\n      <h2>Create organisation</h2>\n    </div>\n    <div class="col-md-4 toolbar__buttons">\n      <button click.delegate="create()" class="btn btn-primary">Submit</button>\n      <a route-href="route: d-orgs-list" class="btn btn-default">Cancel</a>\n    </div>\n  </div>\n\n  <compose view="./../orgs-show/orgs-form.html"></compose>\n</template>\n'}),define("text!dashboard/index/index.html",["module"],function(e){e.exports="<template>\n  <h1>Dashboard index</h1>\n</template>\n"}),define("text!dashboard/orgs-show/orgs-form.html",["module"],function(e){e.exports='<template>\n  <form>\n    <div class="row">\n      <div class="col-md-4">\n        <fieldset>\n          <legend>General</legend>\n          <div class="form-group ${errors.name ? \'has-error\' : \'\'}">\n            <label for="name" class="control-label">Name</label>\n            <input type="text" class="form-control" id="name" placeholder="Name" value.bind="input.name">\n          </div>\n          <div class="form-group ${errors.mailAddress ? \'has-error\' : \'\'}">\n            <label for="mailAddress" class="control-label">Email address</label>\n            <input type="email" class="form-control" id="mailAddress" placeholder="Email address" value.bind="input.mailAddress">\n            <span if.bind="errors.mailAddress == \'Conflict\'" class="help-block">Email address already in use.</span>\n          </div>\n          <div class="form-group ${errors.category ? \'has-error\' : \'\'}">\n            <label for="category" class="control-label">Category</label>\n            <select class="form-control" id="category" placeholder="Category" value.bind="input.category">\n              <option>université</option>\n              <option>bibliothéque</option>\n            </select>\n          </div>\n        </fieldset>\n      </div>\n      <div class="col-md-4">\n        <fieldset>\n          <legend>Address</legend>\n          <div class="form-group ${errors[\'address.street1\'] ? \'has-error\' : \'\'}">\n            <label for="address.street1" class="control-label">Street 1</label>\n            <input type="text" class="form-control" id="address.street1" placeholder="Name" value.bind="input.address.street1" place-autocomplete="target.bind: input;">\n          </div>\n          <div class="form-group ${errors[\'address.street2\'] ? \'has-error\' : \'\'}">\n            <label for="address.street2" class="control-label">Street 2</label>\n            <input type="text" class="form-control" id="address.street2" placeholder="Name" value.bind="input.address.street2">\n          </div>\n          <div class="form-group ${errors[\'address.postalCode\'] ? \'has-error\' : \'\'}">\n            <label for="address.postalCode" class="control-label">Postal code</label>\n            <input type="text" class="form-control" id="address.postalCode" placeholder="Name" value.bind="input.address.postalCode">\n          </div>\n          <div class="form-group ${errors[\'address.locality\'] ? \'has-error\' : \'\'}">\n            <label for="address.locality" class="control-label">Locality</label>\n            <input type="text" class="form-control" id="address.locality" placeholder="Name" value.bind="input.address.locality">\n          </div>\n          <div class="form-group ${errors[\'address.country\'] ? \'has-error\' : \'\'}">\n            <label for="address.country" class="control-label">Country</label>\n            <input type="text" class="form-control" id="address.country" placeholder="Name" value.bind="input.address.country">\n          </div>\n        </fieldset>\n      </div>\n      <div class="col-md-4">\n        <fieldset>\n          <legend>Contact</legend>\n          <div class="form-group ${errors[\'contact.name\'] ? \'has-error\' : \'\'}">\n            <label for="contact.name" class="control-label">Name</label>\n            <input type="text" class="form-control" id="contact.name" placeholder="Name" value.bind="input.contact.name">\n          </div>\n          <div class="form-group ${errors[\'contact.mailAddress\'] ? \'has-error\' : \'\'}">\n            <label for="contact.mailAddress" class="control-label">Email address</label>\n            <input type="email" class="form-control" id="contact.mailAddress" placeholder="Email address" value.bind="input.contact.mailAddress">\n          </div>\n          <div class="form-group ${errors[\'contact.phoneNumber\'] ? \'has-error\' : \'\'}">\n            <label for="contact.phoneNumber" class="control-label">Phone number</label>\n            <input type="text" class="form-control" id="contact.phoneNumber" placeholder="Phone number" value.bind="input.contact.phoneNumber">\n          </div>\n        </fieldset>\n      </div>\n    </div>\n  </form>\n</template>\n'}),define("text!dashboard/orgs-show/orgs-show.html",["module"],function(e){e.exports='<template>\n  <ol class="breadcrumb">\n    <li><a route-href="route: d-orgs-list">Organisations</a></li>\n    <li class="active">${org.name}</li>\n  </ol>\n\n  <div class="row toolbar">\n    <div class="col-md-8 toolbar__header">\n      <h2>${org.name}</h2>\n    </div>\n    <div class="col-md-4 toolbar__buttons">\n      <!-- Not editing -->\n      <button if.bind="!isEditing" click.delegate="startEdit()" class="btn btn-default">Edit</button>\n      <button if.bind="!isEditing" click.delegate="delete()" class="btn btn-danger">Delete</button>\n\n      <!-- Editing -->\n      <button if.bind="isEditing" click.delegate="update()" class="btn btn-primary">Update</button>\n      <button if.bind="isEditing" click.delegate="cancelEdit()" class="btn btn-default">Cancel</button>\n    </div>\n  </div>\n\n  <div if.bind="!isEditing">\n    <div class="row">\n      <div class="col-md-4">\n        <fieldset>\n          <legend>General</legend>\n          <div class="form-group">\n            <label class="control-label">Name</label>\n            <div>${org.name}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Email address</label>\n            <div>${org.mailAddress}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Category</label>\n            <div>${org.category}</div>\n          </div>\n        </fieldset>\n      </div>\n      <div class="col-md-4">\n        <fieldset>\n          <legend>Address</legend>\n          <div class="form-group">\n            <label class="control-label">Street 1</label>\n            <div>${org.address.street1 || \'/\'}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Street 2</label>\n            <div>${org.address.street2 || \'/\'}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Postal code</label>\n            <div>${org.address.postalCode}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Locality</label>\n            <div>${org.address.locality}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Country</label>\n            <div>${org.address.country || \'/\'}</div>\n          </div>\n        </fieldset>\n      </div>\n      <div class="col-md-4">\n        <fieldset>\n          <legend>Contact</legend>\n          <div class="form-group">\n            <label class="control-label">Name</label>\n            <div>${org.contact.name}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Email address</label>\n            <div>${org.contact.mailAddress}</div>\n          </div>\n          <div class="form-group">\n            <label class="control-label">Phone number</label>\n            <div>${org.contact.phoneNumber || \'/\'}</div>\n          </div>\n        </fieldset>\n      </div>\n    </div>\n  </div>\n\n  <div if.bind="isEditing">\n    <compose view="./orgs-form.html"></compose>\n  </div>\n</template>\n'}),define("text!dashboard/orgs-list/orgs-list.html",["module"],function(e){e.exports='<template>\n  <ol class="breadcrumb">\n    <li class="active">Organisations</li>\n  </ol>\n  <div class="row toolbar">\n    <div class="col-md-8 toolbar__header">\n      <h2 click.delegate="foo()">Organisations</h2>\n    </div>\n    <div class="col-md-4 toolbar__buttons">\n      <a class="btn btn-default" route-href="route: d-orgs-create">Create</a>\n    </div>\n  </div>\n\n  <table class="table">\n    <thead>\n      <tr>\n        <th>#</th>\n        <th>Name</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr repeat.for="org of organisations">\n        <td width="50">${org.id}</td>\n        <td>\n          <a route-href="route: d-orgs-show; params.bind: {id: org.id}">${org.name}</a>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</template>\n'});